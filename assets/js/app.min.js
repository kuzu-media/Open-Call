/*jshint devel:true */
/*global angular */

var OpenCall = angular.module("OpenCall", ["firebase"]);

OpenCall.run(['angularFireAuth',"FIREBASE_URL","firebaseRefManager","$rootScope",function(angularFireAuth,FIREBASE_URL,firebaseRefManager,$rootScope)
{
	var firbase_ref = firebaseRefManager(FIREBASE_URL);
	angularFireAuth.initialize(firbase_ref,{'scope': $rootScope,'name':'user','path':'/welcome'});
}]);

OpenCall.constant("FIREBASE_URL","https://opencall.firebaseio.com/");


/* **********************************************
     Begin routes.js
********************************************** */

/*global OpenCall */
OpenCall.config(function($routeProvider)
{
	$routeProvider
	.when("/",{
		templateUrl: 'app/views/events.html',
		controller: "Events",
		authRequired: true
	})
	.when("/welcome",{
		templateUrl: 'app/views/welcome.html',
		controller: "User",
		authRequired: false
	})
	.when("/join",{
		templateUrl: 'app/views/join.html',
		controller: "User",
		authRequired: false
	})
	.when("/login",{
		templateUrl: 'app/views/login.html',
		controller: "User",
		authRequired: false
	});
});

/* **********************************************
     Begin firebaseRefManager.js
********************************************** */

/*global angular */
angular.module("firebase").factory("firebaseRefManager",["Firebase",function(Firebase)
{
	var refs = {};
	return function(url)
	{
		if(!refs[url])
		{
			// create the collection
			refs[url] = new Firebase(url);
		}

		// return the promise
		return refs[url];
	};
}]);